"""
Review Tag Mapper
-----------------
이 스크립트는 사용자의 문장을 미리 정의된 태그 목록 중에서
의미가 가장 가까운 태그(최대 3개)를 골라 JSON 형식으로 반환합니다.
(OpenAI Chat Completions API 활용)

📌 실행 준비
1) Python 패키지 설치:
   pip install openai python-dotenv

2) .env 파일 생성 (프로젝트 루트에 위치)
   OPENAI_API_KEY=sk-본인의APIKEY

   ⚠️ API Key는 코드에 직접 쓰지 말고 반드시 .env 로 관리하세요.

3) requirements.txt 예시:
   openai>=1.0.0
   python-dotenv>=1.0.0

💻 실행 방법
   python naver_tag_mapper.py

예시 입력: 하단의 "role" : "user" 부분으로 입력 바꿔서 test가능
   "데이트를 하려고 해. 예쁜 경치에 좀 조용한 곳이면 좋겠어. 그리고 난 냄새가 강한 음식은 못 먹어."

예시 출력(JSON):
   {"tags": ["뷰가 좋아요", "차분한 분위기예요", "잡내가 적어요"]}
"""



import os
from openai import OpenAI
client = OpenAI(api_key="#본인의 API KEY 넣으시면 됩니다") 


#시스템 지시 정의
SYSTEM="""너는 사용자의 문장을 분석해 미리 정의된 태그 중 '의미가 가장 가까운 것들'만 고른다.
- 사용자가 직접 쓰지 않은 단어여도 의미가 같으면 해당 태그로 '매핑'한다. (예: "푸짐한" → "양이 많아요")
- 반드시 아래 '태그 목록' 중에서만 선택한다. 새로운 문구를 만들지 말 것.
- 최대 3개 이내로, 중복 없이 고를 것. 관련이 없으면 []를 반환한다.
- 출력은 json 형식의 객체 하나만 반환한다. (예: {"tags":["양이 많아요","분위기가 좋아요"]})

태그 목록:
[음식/가격] 음식이 맛있어요, 재료가 신선해요, 양이 많아요, 특별한 메뉴가 있어요, 가성비가 좋아요, 커피가 맛있어요,\
    건강한 맛이에요, 향신료가 강하지 않아요, 디저트가 맛있어요, 반찬이 잘 나와요, 비싼 만큼 가치있어요,\
    코스요리가 알차요, 술이 다양해요, 잡내가 적어요, 기본 안주가 좋아요, 고기 질이 좋아요, 음료가 맛있어요, 메뉴 구성이 알차요, 현지 맛에 가까워요

[분위기] 인테리어가 멋져요, 매장이 넓어요, 혼밥하기 좋아요, 단체모임 하기 좋아요, 뷰가 좋아요, 컨셉이 독특해요,\
      야외공간이 멋져요, 차분한 분위기예요, 혼술하기 좋아요, 대화하기 좋아요, 집중하기 좋아요, 사진이 잘 나와요, 음악이 좋아요, 아늑해요


[기타] 친절해요, 매장이 청결해요, 화장실이 꺠끗해요, 주차하기 편해요, 특별한 날 가기 좋아요, 포장이 깔끔해요, 룸이 잘 되어있어요,\
      음식이  빨리 나와요, 반려동물과 가기 좋아요, 샐러드바가 잘 되어있어요, 아이와 가기 좋아요, 직접 잘 구워줘요,\
      오래 머무르기 좋아요, 좌석이 편해요, 환기가 잘 돼요

예시 매핑:
- "푸짐하게 주는 식당" → ["양이 많아요"]
- "사장님 성격이 밝으시고 맛집이에요" → ["친절해요","음식이 맛있어요"]
"""

response = client.chat.completions.create(
    model="gpt-4o-mini",
    response_format={ "type": "json_object" },
    messages=[
        {"role":"system","content":SYSTEM},
        {"role":"user","content":"데이트를 하려고 해. 예쁜 경치에 좀 조용한 곳이면 좋겠어. 그리고 난 냄새가 강한 음식은 못 먹어."}
    ]
)

result=response.choices[0].message.content
print(result)

